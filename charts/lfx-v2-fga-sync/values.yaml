# Copyright The Linux Foundation and each contributor to LFX.
# SPDX-License-Identifier: MIT
---

# image is the configuration for the container image
image:
  # repository is the container image repository
  repository: ghcr.io/linuxfoundation/lfx-v2-fga-sync/lfx-v2-fga-sync
  # tag is the container image tag (defaults to appVersion if not specified)
  tag: ""
  # pullPolicy is the image pull policy
  pullPolicy: "IfNotPresent"

# deployment is the configuration for the deployment
deployment:
  # labels are additional labels to add to the deployment
  # When fga-operator is running in the cluster, adding the label
  # 'openfga-store: <store-name>' will automatically populate the
  # OPENFGA_STORE_ID and OPENFGA_AUTH_MODEL_ID environment variables
  # on the pod, overriding fga.storeId and fga.modelId
  labels:
    openfga-store: "lfx-core"
  # podLabels are additional labels to add to the pods
  podLabels: {}

# nats is the configuration for the NATS server
nats:
  # url is the URL of the NATS server
  url: nats://lfx-platform-nats.lfx.svc.cluster.local:4222

  # cacheFgaKvBucket is the configuration for the KV bucket for storing FGA cache
  cacheFgaKvBucket:
    # creation is a boolean to determine if the KV bucket should be created via the helm chart.
    # set it to false if you want to use an existing KV bucket.
    creation: true
    # keep is a boolean to determine if the KV bucket should be preserved during helm uninstall
    # set it to false if you want the bucket to be deleted when the chart is uninstalled
    keep: true
    # name is the name of the KV bucket for storing FGA cache
    name: fga-sync-cache
    # history is the number of history entries to keep for the KV bucket
    history: 20
    # ttl is the time to live for the KV bucket
    ttl: 3h
    # storage is the storage type for the KV bucket
    storage: file
    # maxValueSize is the maximum size of a value in the KV bucket
    maxValueSize: 10485760 # 10MB
    # maxBytes is the maximum number of bytes in the KV bucket
    maxBytes: 1073741824 # 1GB
    # compression is a boolean to determine if the KV bucket should be compressed
    compression: true

# fga is the configuration for the OpenFGA server
# These values come from the lfx-platform helm chart repo:
# https://github.com/linuxfoundation/lfx-v2-helm/blob/main/docs/openfga.md
fga:
  # apiUrl is the URL of the OpenFGA API server
  apiUrl: http://lfx-platform-openfga.lfx.svc.cluster.local:8080
  # storeId is the ID of the OpenFGA store, ignored if
  # deployment.labels.openfga-store is set and the fga-operator is
  # running
  storeId: ""
  # modelId is the ID of the OpenFGA model, ignored if
  # deployment.labels.openfga-store is set and the fga-operator is
  # running
  modelId: ""

# application is the configuration for the application
application:
  # debug is a boolean to determine if the application should run in debug mode
  debug: false
  # useCache is a boolean to determine if the application should use the cache
  # Only turn it off if you are developing locally and are writing to the OpenFGA store
  # outside of this service (e.g. granting certain access to a test user manually)
  useCache: true
  # replicas is the number of pod replicas
  replicas: 1
  # resources is the resource configuration for the pods
  resources:
    requests:
      memory: "64Mi"
      cpu: "100m"
    limits:
      memory: "128Mi"
      cpu: "500m"

# app contains additional application configuration
app:
  # extraEnv allows adding additional environment variables to the container
  # Supports both simple values and Kubernetes field references like status.hostIP
  # Example:
  #   extraEnv:
  #     - name: HOST_IP
  #       valueFrom:
  #         fieldRef:
  #           fieldPath: status.hostIP
  extraEnv: []
  # otel is the configuration for OpenTelemetry tracing
  otel:
    # serviceName is the service name for OpenTelemetry resource identification
    # (default: "lfx-v2-fga-sync")
    serviceName: ""
    # serviceVersion is the service version for OpenTelemetry resource identification
    # (default: build-time Version variable, typically "dev" for local builds)
    serviceVersion: ""
    # protocol specifies the OTLP protocol: "grpc" or "http"
    # (default: "grpc")
    protocol: "grpc"
    # endpoint is the OTLP collector endpoint
    # For gRPC: typically "host:4317", for HTTP: typically "host:4318"
    endpoint: ""
    # insecure disables TLS for the OTLP connection
    # Set to "true" for in-cluster communication without TLS
    insecure: "false"
    # tracesExporter specifies the traces exporter: "otlp" or "none"
    # (default: "none")
    tracesExporter: "none"
    # tracesSampleRatio specifies the sampling ratio for traces (0.0 to 1.0)
    # A value of 1.0 means all traces are sampled, 0.5 means 50% are sampled
    # (default: "1.0")
    tracesSampleRatio: "1.0"
    # metricsExporter specifies the metrics exporter: "otlp" or "none"
    # (default: "none")
    metricsExporter: "none"
    # logsExporter specifies the logs exporter: "otlp" or "none"
    # (default: "none")
    logsExporter: "none"
    # propagators specifies the context propagators to use
    # Comma-separated list of: "tracecontext", "baggage", "jaeger"
    # (default: "tracecontext,baggage")
    propagators: "tracecontext,baggage,jaeger"
